# Django åç«¯é¡¹ç›®

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æ¨¡å—åŒ–Djangoåç«¯æ¡†æ¶ï¼Œæ”¯æŒMySQLæ•°æ®åº“ã€‚

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„Djangoåç«¯é¡¹ç›®ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼ŒåŒ…å«ç”¨æˆ·ç®¡ç†ã€èº«ä»½è®¤è¯ã€AIåŠŸèƒ½ã€å…ƒå®‡å®™å’Œç¤¾äº¤åŠŸèƒ½ç­‰æ¨¡å—ã€‚

## ä¸»è¦ç‰¹æ€§

- âœ… **æ¨¡å—åŒ–æ¶æ„**: æŒ‰åŠŸèƒ½åˆ’åˆ†çš„åº”ç”¨æ¨¡å—
- âœ… **MySQLæ•°æ®åº“**: ç”Ÿäº§çº§æ•°æ®åº“æ”¯æŒ
- âœ… **RESTful API**: Django REST Framework
- âœ… **ç”¨æˆ·è®¤è¯**: å®Œæ•´çš„è®¤è¯ç³»ç»Ÿ
- âœ… **æƒé™ç®¡ç†**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- âœ… **ç¼“å­˜æ”¯æŒ**: Redisç¼“å­˜
- âœ… **å¼‚æ­¥ä»»åŠ¡**: Celeryæ”¯æŒ
- âœ… **APIæ–‡æ¡£**: è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£
- âœ… **å®‰å…¨æ€§**: å¤šé‡å®‰å…¨é˜²æŠ¤
- âœ… **AIé›†æˆ**: å¤šæ¨¡å‹AIåŠŸèƒ½æ”¯æŒ
- âœ… **å…ƒå®‡å®™ä½“éªŒ**: è™šæ‹Ÿä¸–ç•Œå’Œäº¤äº’ç³»ç»Ÿ
- âœ… **ç¤¾äº¤ç½‘ç»œ**: å®Œæ•´çš„ç¤¾äº¤åŠŸèƒ½

## é¡¹ç›®ç»“æ„

```
Backend/
â”œâ”€â”€ manage.py                    # Djangoç®¡ç†è„šæœ¬
â”œâ”€â”€ requirements.txt             # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ backend/                    # ä¸»é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py             # é¡¹ç›®è®¾ç½® âœ…
â”‚   â”œâ”€â”€ urls.py                 # ä¸»URLé…ç½® âœ…
â”‚   â”œâ”€â”€ wsgi.py                 # WSGIé…ç½®
â”‚   â”œâ”€â”€ asgi.py                 # ASGIé…ç½®
â”‚   â””â”€â”€ celery.py               # Celeryé…ç½®
â””â”€â”€ apps/                       # åº”ç”¨æ¨¡å—
    â”œâ”€â”€ users/                  # ç”¨æˆ·ç®¡ç† âœ…
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ apps.py
    â”‚   â”œâ”€â”€ models.py           # ç”¨æˆ·æ¨¡å‹
    â”‚   â”œâ”€â”€ serializers.py      # åºåˆ—åŒ–å™¨
    â”‚   â”œâ”€â”€ views.py            # è§†å›¾
    â”‚   â”œâ”€â”€ urls.py             # URLé…ç½®
    â”‚   â”œâ”€â”€ admin.py            # ç®¡ç†ç•Œé¢
    â”‚   â””â”€â”€ signals.py          # ä¿¡å·å¤„ç†
    â”œâ”€â”€ authentication/         # èº«ä»½è®¤è¯ âœ…
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ apps.py
    â”‚   â”œâ”€â”€ models.py           # è®¤è¯æ¨¡å‹
    â”‚   â”œâ”€â”€ serializers.py      # è®¤è¯åºåˆ—åŒ–å™¨
    â”‚   â”œâ”€â”€ views.py            # è®¤è¯è§†å›¾ âœ…
    â”‚   â”œâ”€â”€ urls.py             # è®¤è¯URL âœ…
    â”‚   â””â”€â”€ admin.py            # ç®¡ç†ç•Œé¢ âœ…
    â”œâ”€â”€ core/                   # æ ¸å¿ƒåŠŸèƒ½ âœ…
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ apps.py
    â”‚   â”œâ”€â”€ models.py           # æ ¸å¿ƒæ¨¡å‹
    â”‚   â”œâ”€â”€ views.py            # æ ¸å¿ƒè§†å›¾
    â”‚   â”œâ”€â”€ urls.py             # æ ¸å¿ƒURL
    â”‚   â”œâ”€â”€ admin.py            # ç®¡ç†ç•Œé¢
    â”‚   â””â”€â”€ exceptions.py       # å¼‚å¸¸å¤„ç†
    â”œâ”€â”€ ai/                     # AIåŠŸèƒ½ âœ…
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ apps.py
    â”‚   â”œâ”€â”€ models.py           # AIæ¨¡å‹
    â”‚   â”œâ”€â”€ serializers.py      # AIåºåˆ—åŒ–å™¨
    â”‚   â”œâ”€â”€ views.py            # AIè§†å›¾
    â”‚   â”œâ”€â”€ urls.py             # AI URL
    â”‚   â”œâ”€â”€ admin.py            # ç®¡ç†ç•Œé¢
    â”‚   â””â”€â”€ signals.py          # ä¿¡å·å¤„ç†
    â”œâ”€â”€ metaverse/              # å…ƒå®‡å®™åŠŸèƒ½ âœ…
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ apps.py
    â”‚   â”œâ”€â”€ models.py           # å…ƒå®‡å®™æ¨¡å‹
    â”‚   â”œâ”€â”€ urls.py             # å…ƒå®‡å®™URL
    â”‚   â”œâ”€â”€ serializers.py      # åºåˆ—åŒ–å™¨ (å¾…åˆ›å»º)
    â”‚   â”œâ”€â”€ views.py            # è§†å›¾ (å¾…åˆ›å»º)
    â”‚   â””â”€â”€ admin.py            # ç®¡ç†ç•Œé¢ (å¾…åˆ›å»º)
    â””â”€â”€ social/                 # ç¤¾äº¤åŠŸèƒ½ âœ…
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ apps.py
        â”œâ”€â”€ urls.py             # ç¤¾äº¤URL
        â”œâ”€â”€ models.py           # ç¤¾äº¤æ¨¡å‹ (å¾…åˆ›å»º)
        â”œâ”€â”€ serializers.py      # åºåˆ—åŒ–å™¨ (å¾…åˆ›å»º)
        â”œâ”€â”€ views.py            # è§†å›¾ (å¾…åˆ›å»º)
        â””â”€â”€ admin.py            # ç®¡ç†ç•Œé¢ (å¾…åˆ›å»º)
```

## å·²å®Œæˆçš„åŠŸèƒ½

### ç”¨æˆ·ç®¡ç†æ¨¡å— (apps/users)
- âœ… æ‰©å±•ç”¨æˆ·æ¨¡å‹ (User, UserProfile, UserLoginLog)
- âœ… ç”¨æˆ·ç®¡ç†ç•Œé¢ (Django Admin)
- âœ… ç”¨æˆ·API (æ³¨å†Œã€ç™»å½•ã€ä¸ªäººèµ„æ–™ç®¡ç†)
- âœ… ç”¨æˆ·æƒé™å’Œç»Ÿè®¡
- âœ… ä¿¡å·å¤„ç† (è‡ªåŠ¨åˆ›å»ºç”¨æˆ·æ¡£æ¡ˆã€ç™»å½•æ—¥å¿—)

### èº«ä»½è®¤è¯æ¨¡å— (apps/authentication)
- âœ… è®¤è¯æ¨¡å‹ (é‚®ç®±éªŒè¯ã€å¯†ç é‡ç½®ã€APIå¯†é’¥ç­‰)
- âœ… è®¤è¯åºåˆ—åŒ–å™¨ (ç™»å½•ã€æ³¨å†Œã€å¯†ç é‡ç½®ç­‰)
- âœ… è®¤è¯è§†å›¾ (å®Œæ•´çš„è®¤è¯åŠŸèƒ½)
- âœ… è®¤è¯URLé…ç½® (å®Œæ•´çš„è·¯ç”±)
- âœ… ç®¡ç†ç•Œé¢ (Django Admin)

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å— (apps/core)
- âœ… æ ¸å¿ƒæ¨¡å‹ (ç³»ç»Ÿæ—¥å¿—ã€æ ‡ç­¾ã€é™„ä»¶ç­‰)
- âœ… æ ¸å¿ƒè§†å›¾ (ç³»ç»ŸçŠ¶æ€ã€å¥åº·æ£€æŸ¥)
- âœ… æ ¸å¿ƒURLé…ç½®
- âœ… ç®¡ç†ç•Œé¢å’Œå¼‚å¸¸å¤„ç†

### AIåŠŸèƒ½æ¨¡å— (apps/ai)
- âœ… AIæ¨¡å‹ç®¡ç† (å¤šç§AIæ¨¡å‹æ”¯æŒ)
- âœ… èŠå¤©å¯¹è¯ç³»ç»Ÿ (å®Œæ•´çš„å¯¹è¯ç®¡ç†)
- âœ… AIæ¨¡æ¿ç³»ç»Ÿ (æç¤ºæ¨¡æ¿ç®¡ç†)
- âœ… ä½¿ç”¨ç»Ÿè®¡ (è¯¦ç»†çš„ä½¿ç”¨è¿½è¸ª)
- âœ… OpenAIå…¼å®¹æ¥å£
- âœ… å®Œæ•´çš„APIç«¯ç‚¹å’Œç®¡ç†ç•Œé¢

### å…ƒå®‡å®™åŠŸèƒ½æ¨¡å— (apps/metaverse)
- âœ… è™šæ‹Ÿä¸–ç•Œæ¨¡å‹ (ä¸–ç•Œã€å½¢è±¡ã€ä¼šè¯)
- âœ… è™šæ‹Ÿç‰©å“ç³»ç»Ÿ (ç‰©å“å’Œå®ä¾‹ç®¡ç†)
- âœ… æ´»åŠ¨ç³»ç»Ÿ (äº‹ä»¶å’Œå‚ä¸è€…)
- âœ… æƒé™ç®¡ç† (ä¸–ç•Œè®¿é—®æ§åˆ¶)
- âœ… URLè·¯ç”±é…ç½®
- â³ åºåˆ—åŒ–å™¨ã€è§†å›¾å’Œç®¡ç†ç•Œé¢ (å¾…å®Œæˆ)

### ç¤¾äº¤åŠŸèƒ½æ¨¡å— (apps/social)
- âœ… URLè·¯ç”±é…ç½® (å®Œæ•´çš„ç¤¾äº¤åŠŸèƒ½ç«¯ç‚¹)
- â³ ç¤¾äº¤æ¨¡å‹ (å¥½å‹ã€ç¾¤ç»„ã€åŠ¨æ€ç­‰) (å¾…å®Œæˆ)
- â³ åºåˆ—åŒ–å™¨ã€è§†å›¾å’Œç®¡ç†ç•Œé¢ (å¾…å®Œæˆ)

## æ ¸å¿ƒæ¨¡å‹

### ç”¨æˆ·æ¨¡å‹ (User)
- æ‰©å±•Djangoé»˜è®¤ç”¨æˆ·æ¨¡å‹
- æ”¯æŒå¤´åƒã€ç”Ÿæ—¥ã€æ€§åˆ«ã€ç®€ä»‹ç­‰å­—æ®µ
- ç¤¾äº¤åª’ä½“é“¾æ¥ (ç½‘ç«™ã€GitHub)
- è´¦æˆ·è®¾ç½® (éªŒè¯çŠ¶æ€ã€é«˜çº§ç”¨æˆ·)
- éšç§è®¾ç½® (JSONå­—æ®µ)

### è®¤è¯æ¨¡å‹
- **EmailVerificationToken**: é‚®ç®±éªŒè¯ä»¤ç‰Œ
- **PasswordResetToken**: å¯†ç é‡ç½®ä»¤ç‰Œ
- **LoginAttempt**: ç™»å½•å°è¯•è®°å½•
- **TwoFactorAuth**: åŒå› å­è®¤è¯
- **APIKey**: APIå¯†é’¥ç®¡ç†

### AIæ¨¡å‹
- **AIModel**: AIæ¨¡å‹ç®¡ç†
- **AIRequest**: AIè¯·æ±‚è®°å½•
- **ChatConversation**: èŠå¤©å¯¹è¯
- **ChatMessage**: èŠå¤©æ¶ˆæ¯
- **AITemplate**: AIæ¨¡æ¿
- **AIUsageStats**: ä½¿ç”¨ç»Ÿè®¡

### å…ƒå®‡å®™æ¨¡å‹
- **VirtualWorld**: è™šæ‹Ÿä¸–ç•Œ
- **Avatar**: è™šæ‹Ÿå½¢è±¡
- **UserSession**: ç”¨æˆ·ä¼šè¯
- **VirtualObject**: è™šæ‹Ÿç‰©å“
- **Event**: æ´»åŠ¨äº‹ä»¶
- **WorldPermission**: ä¸–ç•Œæƒé™

## æ•°æ®åº“é…ç½®

é¡¹ç›®é…ç½®ä¸ºä½¿ç”¨MySQLæ•°æ®åº“ï¼š

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': config('DB_NAME', default='backend_db'),
        'USER': config('DB_USER', default='root'),
        'PASSWORD': config('DB_PASSWORD', default=''),
        'HOST': config('DB_HOST', default='localhost'),
        'PORT': config('DB_PORT', default='3306'),
    }
}
```

## APIç«¯ç‚¹

### ç”¨æˆ·ç›¸å…³ API (/api/v1/users/)
- `GET/POST /api/v1/users/` - ç”¨æˆ·åˆ—è¡¨/åˆ›å»º
- `GET/PUT/DELETE /api/v1/users/{id}/` - ç”¨æˆ·è¯¦æƒ…
- `GET/PUT /api/v1/users/me/profile/` - å½“å‰ç”¨æˆ·èµ„æ–™
- `PUT /api/v1/users/me/settings/` - ç”¨æˆ·è®¾ç½®
- `POST /api/v1/users/me/password/` - ä¿®æ”¹å¯†ç 
- `GET /api/v1/users/search/` - ç”¨æˆ·æœç´¢

### è®¤è¯ç›¸å…³ API (/api/v1/auth/)
- `POST /api/v1/auth/login/` - ç”¨æˆ·ç™»å½•
- `POST /api/v1/auth/register/` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/v1/auth/logout/` - ç”¨æˆ·ç™»å‡º
- `POST /api/v1/auth/password-reset/` - å¯†ç é‡ç½®
- `POST /api/v1/auth/verify-email/` - é‚®ç®±éªŒè¯
- `POST /api/v1/auth/refresh-token/` - åˆ·æ–°ä»¤ç‰Œ
- `POST /api/v1/auth/2fa/enable/` - å¯ç”¨åŒå› å­è®¤è¯

### AIåŠŸèƒ½ API (/api/v1/ai/)
- `GET /api/v1/ai/models/` - AIæ¨¡å‹åˆ—è¡¨
- `GET /api/v1/ai/conversations/` - å¯¹è¯åˆ—è¡¨
- `POST /api/v1/ai/chat/send/` - å‘é€æ¶ˆæ¯
- `GET /api/v1/ai/templates/` - æ¨¡æ¿åˆ—è¡¨
- `POST /api/v1/ai/chat/completions/` - OpenAIå…¼å®¹æ¥å£
- `GET /api/v1/ai/stats/user/` - ç”¨æˆ·ç»Ÿè®¡

### å…ƒå®‡å®™ API (/api/v1/metaverse/)
- `GET /api/v1/metaverse/worlds/` - è™šæ‹Ÿä¸–ç•Œåˆ—è¡¨
- `GET /api/v1/metaverse/avatars/` - è™šæ‹Ÿå½¢è±¡åˆ—è¡¨
- `POST /api/v1/metaverse/worlds/{id}/enter/` - è¿›å…¥ä¸–ç•Œ
- `GET /api/v1/metaverse/events/` - æ´»åŠ¨åˆ—è¡¨
- `GET /api/v1/metaverse/objects/` - è™šæ‹Ÿç‰©å“åˆ—è¡¨

### ç¤¾äº¤åŠŸèƒ½ API (/api/v1/social/)
- `GET /api/v1/social/friends/` - å¥½å‹åˆ—è¡¨
- `GET /api/v1/social/groups/` - ç¾¤ç»„åˆ—è¡¨
- `GET /api/v1/social/posts/` - åŠ¨æ€åˆ—è¡¨
- `GET /api/v1/social/messages/` - æ¶ˆæ¯åˆ—è¡¨
- `GET /api/v1/social/notifications/` - é€šçŸ¥åˆ—è¡¨

### æ ¸å¿ƒåŠŸèƒ½ API (/api/v1/core/)
- `GET /api/v1/core/system/health/` - ç³»ç»Ÿå¥åº·æ£€æŸ¥
- `GET /api/v1/core/system/status/` - ç³»ç»ŸçŠ¶æ€
- `GET /api/v1/core/logs/` - ç³»ç»Ÿæ—¥å¿—
- `GET /api/v1/core/tags/` - æ ‡ç­¾ç®¡ç†

## å®‰è£…å’Œè¿è¡Œ

### 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

### 2. å®‰è£…ä¾èµ–
```bash
cd Backend
pip install -r requirements.txt
```

### 3. é…ç½®ç¯å¢ƒå˜é‡
åˆ›å»º `.env` æ–‡ä»¶ï¼š
```env
SECRET_KEY=your-secret-key-here
DEBUG=True
DB_NAME=backend_db
DB_USER=root
DB_PASSWORD=your_password
DB_HOST=localhost
DB_PORT=3306
REDIS_URL=redis://127.0.0.1:6379/1
CELERY_BROKER_URL=redis://127.0.0.1:6379/0
```

### 4. é…ç½®æ•°æ®åº“
```bash
# åˆ›å»ºæ•°æ®åº“
mysql -u root -p
CREATE DATABASE backend_db CHARACTER SET utf8mb4;
```

### 5. æ•°æ®åº“è¿ç§»
```bash
python manage.py makemigrations
python manage.py migrate
```

### 6. åˆ›å»ºè¶…çº§ç”¨æˆ·
```bash
python manage.py createsuperuser
```

### 7. è¿è¡Œå¼€å‘æœåŠ¡å™¨
```bash
python manage.py runserver
```

### 8. å¯åŠ¨Celery (å¯é€‰)
```bash
# å¯åŠ¨Celery Worker
celery -A backend worker -l info

# å¯åŠ¨Celery Beat (å®šæ—¶ä»»åŠ¡)
celery -A backend beat -l info
```

## æŠ€æœ¯æ ˆ

- **Webæ¡†æ¶**: Django 4.2.7
- **APIæ¡†æ¶**: Django REST Framework 3.14.0
- **æ•°æ®åº“**: MySQL (mysqlclient 2.2.0)
- **ç¼“å­˜**: Redis (django-redis 5.4.0)
- **ä»»åŠ¡é˜Ÿåˆ—**: Celery 5.3.4
- **èº«ä»½éªŒè¯**: Tokenè®¤è¯ + Sessionè®¤è¯
- **CORS**: django-cors-headers 4.3.1
- **è¿‡æ»¤**: django-filter 23.3
- **å›¾åƒå¤„ç†**: Pillow 10.1.0
- **APIæ–‡æ¡£**: drf-spectacular 0.26.5
- **ç¯å¢ƒé…ç½®**: python-decouple 3.8

## å¼€å‘è§„èŒƒ

- éµå¾ªDjangoç¼–ç è§„èŒƒ (PEP 8)
- ä½¿ç”¨ç±»å‹æç¤º
- å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²
- å•å…ƒæµ‹è¯•è¦†ç›–
- å®‰å…¨æœ€ä½³å®è·µ
- æ¨¡å—åŒ–è®¾è®¡
- RESTful APIè®¾è®¡

## é¡¹ç›®ç‰¹è‰²åŠŸèƒ½

### AIé›†æˆ
- å¤šç§AIæ¨¡å‹æ”¯æŒ (æ–‡æœ¬ã€å›¾åƒã€è¯­éŸ³ç­‰)
- èŠå¤©å¯¹è¯ç®¡ç†
- AIæ¨¡æ¿ç³»ç»Ÿ
- OpenAIå…¼å®¹æ¥å£
- ä½¿ç”¨ç»Ÿè®¡å’Œæˆæœ¬è¿½è¸ª

### å…ƒå®‡å®™ä½“éªŒ
- è™šæ‹Ÿä¸–ç•Œåˆ›å»ºå’Œç®¡ç†
- è™šæ‹Ÿå½¢è±¡ç³»ç»Ÿ
- å®æ—¶ä¼šè¯ç®¡ç†
- è™šæ‹Ÿç‰©å“ç³»ç»Ÿ
- æ´»åŠ¨å’Œäº‹ä»¶ç®¡ç†

### ç¤¾äº¤ç½‘ç»œ
- å¥½å‹å…³ç³»ç®¡ç†
- ç¾¤ç»„åŠŸèƒ½
- åŠ¨æ€å‘å¸ƒå’Œäº’åŠ¨
- ç§ä¿¡ç³»ç»Ÿ
- é€šçŸ¥ç³»ç»Ÿ
- å…³æ³¨åŠŸèƒ½

## ä¸‹ä¸€æ­¥è®¡åˆ’

1. âœ… å®Œæˆè®¤è¯æ¨¡å—çš„è§†å›¾å’ŒURLé…ç½®
2. âœ… åˆ›å»ºæ ¸å¿ƒåŠŸèƒ½æ¨¡å— (core)
3. âœ… åˆ›å»ºAIåŠŸèƒ½æ¨¡å— (ai)
4. âœ… åˆ›å»ºå…ƒå®‡å®™åŠŸèƒ½æ¨¡å— (metaverse) - åŸºç¡€æ¶æ„
5. âœ… åˆ›å»ºç¤¾äº¤åŠŸèƒ½æ¨¡å— (social) - åŸºç¡€æ¶æ„
6. â³ å®Œå–„å…ƒå®‡å®™æ¨¡å—çš„åºåˆ—åŒ–å™¨ã€è§†å›¾å’Œç®¡ç†ç•Œé¢
7. â³ å®Œå–„ç¤¾äº¤æ¨¡å—çš„æ¨¡å‹ã€åºåˆ—åŒ–å™¨ã€è§†å›¾å’Œç®¡ç†ç•Œé¢
8. ğŸ“‹ æ·»åŠ å•å…ƒæµ‹è¯•
9. ğŸ“‹ å®Œå–„APIæ–‡æ¡£
10. ğŸ“‹ éƒ¨ç½²é…ç½®

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License
